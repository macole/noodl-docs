---
title: コンポーネントスタック
hide_title: true
---

import ImportButton from '/src/components/importbutton';
import CopyToClipboardButton from '/src/components/copytoclipboardbutton';
import ReactPlayer from 'react-player';

# コンポーネントスタックガイド

## このガイドで学べること

このガイドでは、[コンポーネントスタック](/nodes/component-stack/component-stack-node)ノードと関連するナビゲーションノード[コンポーネントをスタックにプッシュ](/nodes/component-stack/push-component)および[スタックからコンポーネントをポップ](/nodes/component-stack/pop-component)について見ていきます。

これらは、[ページルーター](/nodes/navigation/page-router)や関連するノードに比べて、別のナビゲーションコンポーネントです。各**ページ**にURLを付与し、ブラウザの戻る履歴を利用するのではなく、**コンポーネントスタック**はアプリ内ですべて完全に処理されます。もちろん、これらのナビゲーションスタイルは組み合わせて使用することができます。このガイドでは、**コンポーネントスタック**と**ポップアップ**を組み合わせています。モーダルウィザードを作成する方法を学びます。

## 概要

このガイドでは以下のトピックをカバーします。

- コンポーネントスタックの定義
- スタックにコンポーネントをプッシュおよびポップ
- スタック内およびスタック外のコンポーネント間でデータを転送
- スタックの上にあるコンポーネント（およびその数）を追跡
- コンポーネントをプッシュおよびポップする際のトランジション

このガイドは[ポップアップガイド](/docs/guides/navigation/popups)の続きであり、最初にそのガイドを見ることをお勧めします。また、Noodlのデータの基本についても知っておくと良いので、[オブジェクト](/docs/guides/data/objects)および[アレイ](/docs/guides/data/arrays)のガイドも見てください。このガイドでは、[イベント](/docs/guides/business-logic/events)も使用します。

## **コンポーネントスタック**を使用してモーダルウィザードを作成する

このガイドでは、**ポップアップ**内に収められた小さな「ウィザード」タイプのUIを作成する方法を示します。これは[ポップアップガイド](/docs/guides/navigation/popups)の続きです。したがって、そのガイドを完了していない場合は、以下のインポートボタンをクリックしてNoodlにプロジェクトをインポートしてください。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/popup-final.png)

<ImportButton
  zip="/docs/guides/navigation/component-stack/popups.zip"
  name="ポップアップの例"
  thumb="/docs/guides/navigation/component-stack/popup-final.png"
/>

</div>

## ポップアップ内のナビゲーション

ポップアップガイドで達成したことを簡単に振り返ります。人々のリストがあり、リスト内の削除を確認するポップアップを作成しました。また、「ポップアップベース」というコンポーネントも作成しました。

今回は、人々のリストにさらに人物を追加できるウィザードスタイルの**ポップアップ**を作成します。ウィザードスタイルとは、ユーザーがエントリを作成するために**ポップアップ**内で複数の画面を通過することを意味します。通常、Noodlでは**ページルーター**ノード（[こちらのガイド](/docs/guides/navigation/basic-navigation)を参照）を使用してナビゲーションを行いますが、これはモーダルステートのアプリには通常向いていません。代わりに、[コンポーネントスタック](/nodes/component-stack/component-stack-node)ノードを使用できます。これはURLに影響を与えず、アプリのモーダルステートにより適しています。また、トランジションもサポートしています。

「新しい人物を追加」のポップアップには3つの状態があります。

1. 新しくリストに追加する人物の名、姓、年齢を入力する
2. 国を選択する
3. 国に基づいて都市を選択する

データの側面についても考える必要があります。ポップアップガイドでは、各人物は以下のタイプのオブジェクトに保存されていることを知っています：

```json
{
	"firstname":<人物の名>,
	"lastname":<人物の姓>,
	"age":<人物の年齢>,
	"location":<人物が住んでいる都市と国>
}
```

計画は以下の通り

です：

1. ポップアップを開いたときに、新しい人物を表す新しい**オブジェクト**を作成する
2. 最初の画面で`firstname`、`lastname`、`age`を**オブジェクト**に入力する
3. 2番目の画面でユーザーが国を選択する
4. 3番目の画面で、国に基づいて都市のオプションを提示し、**オブジェクト**に`location`を保存する
5. ポップアップが閉じられると、新しい**オブジェクト**が**アレイ**に追加される

さあ、始めましょう！

まず、新しいビジュアルコンポーネントを作成します。それを「新しい人物を追加するポップアップ」と名付けます。それに含まれる**グループ**ノードを「ポップアップベース」に置き換えます。そのタイトルを「新しい人物を追加する」に変更します。
その**ポップアップ**のコンテンツとしては、まずウィザードの現在のステップを保持する**テキスト**ノード（「ステップxの3」）を一貫して追加します。そこで**文字列フォーマット**ノードを「ステップ{current_step}の3」という文字列で追加します。

次に、ユーザーがウィザードを進むにつれて変更される動的コンテンツを追加します。**コンポーネントスタック**を作成し、**テキスト**ノードの後に追加します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-1.png)

</div>

## **コンポーネントスタック**にコンポーネントを追加する

**コンポーネントスタック**にコンポーネントを作成する準備ができました。
:::note

**コンポーネントスタック**を使用する場合は、**ページ**コンポーネントを使用しないでください。これらは**ページルーター**専用です。

:::

**コンポーネントスタック**をクリックします。「コンポーネント」の下の「+」をクリックして、新しいコンポーネントを追加します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/component-stack-1.png)

</div>

3つのコンポーネントが必要です。「ステップ1 - 名前」、「ステップ2 - 国」、「ステップ3 - 都市」と呼びます。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/component-stack-2.png)

</div>

これらのコンポーネントを作成する必要があります。それらをより良く追跡するために、それらを独自のフォルダーに入れるので、「人物作成ウィザード」という新しいコンポーネントフォルダーを作成します。「ステップ1」、「ステップ2」、「ステップ3」という3つのビジュアルコンポーネントをフォルダー内に作成します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/folder-1.png)

</div>

「新しい人物を追加するポップアップ」に戻り、**コンポーネントスタック**でコンポーネントを割り当てることができます。それをクリックしてコンポーネントを設定します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/component-stack-3.png)

</div>

**ポップアップ**を開く**ボタン**を追加する時が来ました。メインアプリに戻り、ラベル「新しい人物を追加する」の水平方向に中央揃えされた**ボタン**を追加します。リストとの間に余白を取って、その上に配置してください。次に、新しい**ポップアップを表示**ノードを追加します。**ボタン**の**クリック**シグナルを**ポップアップを表示**の**表示**シグナルに接続します。また、「新しい人物を追加するポップアップ」が表示されるコンポーネントであることを確認してください。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/list-1.png)

</div>

**ボタン**が**ポップアップ**を開くことを確認してください。

ウィザードのデータ部分に取り組む時が来ました。ウィザードが進むにつれてデータを入力できるように、新しい**オブジェクト**を作成するところから始めます。「新しい人物を追加するポップアップ」に**新しいオブジェクトを作成**ノードを追加します。**ポップアップ**が作成されたときに**オブジェクト**の作成をトリガーしたいのですが、「ポップアップベース」コンポーネントで**ディドマウント**シグナルは公開していないため、まずそれを行う必要があります。`ポップアップベース`コンポーネントを開き、**コン

ポーネント出力**に「ディドマウント」という新しいプロパティを追加し、ルート**グループ**の**ディドマウント**シグナルに接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/popup-base-1.png)

</div>

これで、「新しい人物を追加するポップアップ」で`ポップアップベース`コンポーネントの`ディドマウント`シグナルを**新しいオブジェクトを作成**ノードの**実行**シグナルに接続し、**ポップアップ**が開いたときに新しい**オブジェクト**が作成されるようにすることができます。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-2.png)

</div>

## **コンポーネントスタック**内のコンポーネント間でデータを共有する

この新しい**オブジェクト**は、ウィザードでデータを入力するために使用されるため、異なるサブコンポーネントである`ステップ1`、`ステップ2`、`ステップ3`でアクセス可能でなければなりません。**オブジェクト**の**ID**を[変数](/nodes/data/variable/variable-node)に保存することができますが、[コンポーネントオブジェクト](/nodes/component-utilities/component-object)を使用する方が、さらにスマートなソリューションです。**変数**はグローバルですが、**コンポーネントオブジェクト**は、それが配置されているコンポーネントの子（およびサブ子）にのみ利用可能であり、誤って変更されるリスクはありません。

:::tip
**コンポーネントスタック**上のコンポーネントは、**コンポーネントスタック**の子と見なされるため、**コンポーネントスタック**上のさまざまなコンポーネント間でデータを共有する方法として**コンポーネントオブジェクト**を使用することが多くの場合、良いアイデアです。
:::

したがって、「新しい人物を追加するポップアップ」で**コンポーネントオブジェクト**を作成します。それに「新しい人物オブジェクトID」というプロパティを付けます。その後、**新しいプロジェクトを作成**の**ID**を**コンポーネントオブジェクト**の新しいプロパティに接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-3.png)

</div>

これで、最初のコンポーネント`ステップ1`で簡単なフォームを作成する準備が整いました。まず、新しく作成した**オブジェクト**をセットアップしましょう。この場合、[親コンポーネントオブジェクト](/nodes/component-utilities/parent-component-object)を使用して取得します。前と同じプロパティ`新しい人物オブジェクトID`を追加してください。次に、**オブジェクト**ノードの**ID**にそれを接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-1-1.png)

</div>

それでは、名前、姓、年齢のための3つの[テキスト入力](/nodes/ui-controls/text-input)フィールドを追加しましょう。（それぞれ`firstname`、`lastname`、`age`に接続します。最後のものは数字のみ入力可能な**テキスト入力**です。）また、「キャンセル」と「次へ」の2つの**ボタン**を水平レイアウトで**グループ**内に追加します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-1-2.png)

</div>

## **コンポーネントスタック**の外に通信するためにイベントを送信する

この画面で残っているのは、ユーザーが「次へ」をクリックしたときに**テキスト入力**の内容を**オブジェクト**に保存し、次のステップ`ステップ2`に進むことを処理することです。また、「キャンセル」をクリックしたときの処理も必要です。まず後者から始めましょう。

ユーザーが「キャンセル」をクリックしたときは、**ポップアップ**を閉じたいのですが、**ポップアップを閉じる**操作は、直接**ポップアップを表示**を使って開かれたコンポーネントで行う必要があります（つまり、「新しい人物を追加するポップアップ」）。そのコンポーネントにユーザーが「キャンセル」をクリックしたことをどのように通知しますか？再び、**コンポーネントスタック**の上部にあるコンポーネントは、スタックの子と見なされるため、[イベントを送信](/nodes/events/send-event)することで親コンポーネントに通知すること

ができます（**イベント**に関する専用のガイドは[こちら](/docs/guides/business-logic/events)です）。

したがって、**イベントを送信**ノードを追加し、チャネル名を`Cancel Add Person`に設定します。これは親にのみ送信されることを確認します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/event-1.png)

</div>

次に、ユーザーが「キャンセル」をクリックしたときに**送信**をトリガーします。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-1-3.png)

</div>

「新しい人物を追加するポップアップ」に戻り、ここでイベントを受け取るために[イベントを受け取る](/nodes/events/receive-event)ノードを追加する必要があります。`Cancel Add Person`チャネルを設定してください。また、イベントを常に消費する（`Always`に設定）して、ツリーを伝播するのを避けます。**ポップアップを閉じる**ノードを追加します。次に、`ベースポップアップ`で**閉じるトランジションを開始**シグナルをトリガーし、トランジションが終了したとき（**閉じるトランジション終了**シグナルがトリガーされたとき）、**ポップアップを閉じるノード**の**閉じる**をトリガーします。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-4.png)

</div>

## **コンポーネントスタック**でのコンポーネントのプッシュと置き換え

さて、`ステップ1`コンポーネントに戻って、それを完成させましょう。まず、**テキスト入力**の内容を**オブジェクト**に保存する必要があります。これは、**オブジェクトプロパティを設定**ノードを追加し、3つのプロパティ（`firstname`、`lastname`、`age`）を追加して行います。また、**親コンポーネントオブジェクト**から取得した同じ**ID**を設定することを忘れないでください。次に、"Next"**ボタン**の**クリック**シグナルを**オブジェクトプロパティを設定**の**実行**シグナルに接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-1-4.png)

</div>

保存後は、`ステップ2`コンポーネントに移動する必要があります。**コンポーネントをスタックにプッシュ**ノードを追加します。クリックすると、いくつかのオプションが表示されます。ここでは`Main`を使用しています（プロジェクトに複数の**コンポーネントスタック**がある場合は、ここで正しいものを選択する必要があります）。まず、**ターゲットコンポーネント**を`ステップ2 - 国`に変更しましょう。また、**モード**プロパティを見ると、**プッシュ**または**置き換え**を選択できます。ウィザードの各ステップでユーザーが戻ることができるように、**モード**は**プッシュ**のままにしたいと思います。基本的には、各コンポーネントが重なり合ってスタックになり、**コンポーネントスタックをポップ**を使用してスタックの前のコンポーネントに戻ることができます。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/push-component-1.png)

</div>

データが保存されたら、**コンポーネントをスタックにプッシュ**の**ナビゲート**シグナルを**実行完了**シグナルでトリガーする必要があります。

## トランジションの微調整

次のステップへのナビゲーションを試してみてください。**コンポーネントをスタックにプッシュ**の**ダークオーバーレイ**オプションにより、見た目がおかしくなるので、そのオプションのチェックを外してください。トランジションの調整にもっと時間をかけてみてください。たとえば、**シフトトランジション**を100％に変更して、適切なトランジションのように見せることができます。トランジションが機能するためには、含まれる**グループ**ノードが子をクリップすることが重要であることがわかります。`ポップアップベース`コンポーネントでは、**コンポーネントチルドレン**を保持する2番目の**グループ**です。

## `ステップ2`の編集

これは、国のオプションを含む[ラジオボタングループ](/nodes/ui-controls/radio-button-group)で構成される、よ

りシンプルなフォームになります。それでは、それを追加しましょう。`イングランド`、`スコットランド`、`アイルランド`の3つの[ラジオボタン](/nodes/ui-controls/radio-button)と一緒に追加します。各**ラジオボタン**の**ラベル**と**値**がそれぞれの値に設定されていることを確認してください。また、「国を選ぶ」というサブタイトルを追加します。最後に、`ステップ1`からコピー/貼り付けた「戻る」と「次へ」の2つのボタンを下部に追加します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-2-1.png)

</div>

## **コンポーネントスタック**からのポップ

まず、**コンポーネントスタックからポップ**ノードを追加します。ご覧のとおり、**ポップアップを閉じる**と同様に、結果や背面アクションを送信できます。この場合、データを渡す必要はありません。代わりに「戻る」ボタンの**クリック**から**ナビゲート**に接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-2-2.png)

</div>

ご覧のとおり、スタックからポップすると、プッシュトランジションが逆再生されます。コンポーネントのサイズが異なるため、少し厄介ですが、ポップアップが表示および非表示になると、動的にサイズが変更されます。これを修正するために、`ステップ1`、`ステップ2`、`ステップ3`のコンポーネントに固定サイズを設定しましょう。

これを行うには、「新しい人物を追加するポップアップ」に戻り、固定サイズ（250px/300px）の新しい**グループ**を**コンポーネントスタック**の親として移動します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-5.png)

</div>

ボタンの位置が動いたりするなど、まだ少しレイアウトの微調整が必要ですが、それはすぐに修正できます。画面の下部に常にボタンが表示されるようにしたいので、`ステップ1`と`ステップ2`の**ボタン**を含む**グループ**を探します。**グループ**の**マージン**を削除してください。そうしないと、配置と競合します。その後、それを下部に配置します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/group-alignment.png)

</div>

素晴らしいです、これでボタンは画面の下部に固定されます！

代わりに、「次へ」をクリックしたときに`ステップ3`を**コンポーネントスタック**に追加したいと思います。また、選択した国を渡す必要があります。もちろん、私たちの**オブジェクト**にそれを保存することができますが、上記のデータモデルで見るように、国は別々に保存されていません。代わりに、`ステップ3`にそれを渡したいと思います。**コンポーネントオブジェクト**に保存することもできますが、この場合はスタック上のコンポーネントに対する**コンポーネント入力**を使用することができます。

`ステップ3`に行って、**コンポーネント入力**ノードを追加します。ポートに`Country`を追加します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/step-3-1.png)

</div>

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/comp-input-1.png)

</div>

`ステップ2`に戻ると、**コンポーネントをスタックにプッシュ**を追加し、ターゲットとして`ステップ3`を選択する（前と同様にトランジションを修正する）と、`Country`という新しい入力が表示されるのがわかります。**ラジオボタングループ**の**値**を`Country`入力に接続できます。また、「次へ」ボタンの**クリック**を**コンポーネントをスタックにプッシュ**の**ナビゲート**に接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-2-3.png)

</div>

素晴らしい！では、`ステップ3`に進みましょう。ここでは、前のステップで選択された国に応じて、都市のオプションを表示したいと思います。以下のデータを含む**スタティックアレイ**（JSON形式に設定）を作成しましょう：

```json
[
  { "city": "Bristol", "country": "England" },
  { "city": "Hartlepool", "country": "England" },
  { "city": "Newcastle", "country

": "England" },
  { "city": "Wigan", "country": "England" },
  { "city": "Kilkenny", "country": "Ireland" },
  { "city": "Dublin", "country": "Ireland" },
  { "city": "Cork", "country": "Ireland" },
  { "city": "Galway", "country": "Ireland" },
  { "city": "Glasgow", "country": "Scotland" },
  { "city": "Edinburgh", "country": "Scotland" },
  { "city": "Dundee", "country": "Scotland" },
  { "city": "Kildrummy", "country": "Scotland" }
]
```

私たちは、前のステップで選択された国に対してのみ有効な都市のオプションを、**ラジオボタングループ**で表示したいと考えています。それでは、[アレイフィルター](/nodes/data/array/array-filter)から始めましょう。

`country`プロパティでフィルターを追加します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/array-filter-1.png)

</div>

**イコール**タイプ（文字列）であることを確認してください。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/array-filter-2.png)

</div>

次に、**スタティックアレイ**の**アイテム**を**アレイフィルター**の**アイテム**に接続します。次に、**コンポーネント入力**の`country`出力を**アレイフィルター**の国フィルターの**値**に接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/array-filter-3.png)

</div>

**アレイ**を追加して結果を確認します。選択された国に一致するアイテムのみがフィルターされているのがわかります。素晴らしいです！

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-2.png)

</div>

次に、**ラジオボタングループ**、**リピーター**、**ラジオボタン**を使用してリストにオプションを視覚化する必要があります。まず、リストアイテムを作成しましょう。それを「ステップ3リストアイテム」と名付けます。以下のようになります：

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-list-item-1.png)

<CopyToClipboardButton
  json={{
    nodes: [
      {
        id: '5d3f90ec-abf3-7473-b43f-935e02141387',
        type: 'Group',
        x: -163,
        y: -64,
        parameters: { height: { value: 30, unit: 'px' } },
        ports: [],
        children: [
          {
            id: '331e1282-31df-46ad-73ca-69ba2b03f4bc',
            type: 'net.noodl.controls.radiobutton',
            x: -143,
            y: -18,
            parameters: { alignY: 'center' },
            ports: [],
            children: [],
          },
        ],
      },
      {
        id: 'b62673b4-2625-d20c-f473-81b537b7cc54',
        type: 'Model2',
        x: -575,
        y: -92,
        parameters: { properties: 'country,city', idSource: 'foreach' },
        ports: [],
        children: [],
      },
      {
        id: '65ebe7fd-a47d-9edc-8e6d-dac435066879',
        type: 'String Format',
        x: -343,
        y: 67,
        parameters: { format: '{city}, {country}' },
        ports: [],
        children: [],
      },
    ],
    connections: [
      {
        fromId: 'b62673b4-2625-d20c-f473-81b537b7cc54',
        fromProperty: 'prop-city',
        toId: '331e1282-31df-46ad-73ca-69ba2b03f4bc',
        toProperty: 'label',
      },
      {
        fromId: 'b62673b4-2625-d20c-f473-81b537b7cc54',
        fromProperty: 'prop-city',
        toId: '65ebe7fd-a47d-9edc-8e6d-dac435066879',
        toProperty: 'city',
      },
      {
        fromId: 'b62673b4-2625-d20c-f473-81b537b7cc54',
        fromProperty: 'prop-country',
        toId: '65ebe7fd-a47d-9edc-8e6d-dac435066879',
        toProperty: 'country',
      },
      {
        fromId: '65ebe7fd-a47d-9edc-8e6d-dac435066879',
        fromProperty: 'formatted',
        toId: '331e1282-31df-46ad-73ca-69ba2b03f4bc',
        toProperty: 'value',
      },
    ],
  }}
/>

</div>

**オブジェクト**には`country`および`city`の2つのプロパティがあり、**ID**は**リピーター**から取得されます。また、**ラジオボタン**の**値**は、データモデルに合わせた最終的な場所の文字列（例：`Dublin, Ireland`）を作成するために**文字列フォーマット**（文字列`{location}, {city}`を使用）を使用して構築されていることに注意してください。

`ステップ3`コンポーネントに戻って、**ラジオボタングループ**と**リピーター**（新しい`ステップ3リストアイテム`を使用）を追加し、データで供給

します。余白の微調整を行うと、以下のようになります。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-3.png)

</div>

素晴らしいです！前のステップから**ボタン**をコピー/貼り付けてみましょう（これらは再利用可能なコンポーネントにすべきですね！）。また、「戻る」ボタンに接続された**コンポーネントスタックからポップ**ノードも持ってきましょう。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-4.png)

</div>

## 作成された**オブジェクト**を保存する

ウィザードをほぼ完成させました。最後のステップで「次へ」をクリックしたときに、新しい人物に関する情報を含む**オブジェクト**を保存する必要があります。これは、`ステップ1`コンポーネントと同じ方法で行います。**ポップアップ**で作成された**オブジェクト**を取得するために**親コンポーネントオブジェクト**を使用します。今回は、**ラジオボタングループ**の**値**を`location`というプロパティに保存します。ユーザーが「次へ」をクリックしたときに値を保存します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-5.png)

</div>

最後に、最終ステージで「次へ」をクリックしたときに**オブジェクト**が入力されていることを「新しい人物を追加するポップアップ」に知らせる必要があります。再び、**イベント**を送信することでこれを行います。今回は**チャネル名**`Confirm Add Person`を使用し、**親**に送信します。これは**オブジェクトプロパティを設定**が完了したときに行います。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-3-6.png)

</div>

## **ポップアップ**からデータを渡す

`新しい人物を追加するポップアップ`に戻って、`Confirm Add Person`チャネルからイベントを受け取るために**イベントを受け取るノード**を追加します。

### イベントロジック

ここでは、少し複雑なロジックが必要です。`Cancel Add Person`と`Confirm Add Person`の両方が**ポップアップ**の閉じるトランジションをトリガーするため、トランジションが準備完了した場合に2つのケースを区別する必要があります。なぜなら、`Confirm Add Person`の場合は、作成された**オブジェクト**をメインアプリに渡して、人々のリストに追加したいからです。

**スイッチ**ノードを追加します。これは、`Confirm Add Person`イベントが受信された場合にのみtrueに設定されます。その後、トランジションが閉じられると、**条件**ノードを使用して**スイッチ**の値をテストします。ケースに応じて（つまり、**条件**ノードの**onTrue**または**onFalse**）、**ポップアップを閉じる**ノードの2つの異なる**クローズアクション**（`Confirm`または`Cancel`）をトリガーします。また、人物を表す**オブジェクト**の**ID**を`New Person Object Id`という結果として**ポップアップを閉じる**ノードに渡すことを忘れないでください。

全体は以下のようになります。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/add-new-person-6.png)

</div>

## **オブジェクト**を**アレイ**に追加する

最後に、メインアプリで**オブジェクト**を受け取ります。それは`New Person Object Id`を通じて取得され、`Confirm Add Person`の信号が**ポップアップ**から送られた場合にリストに追加されます。**アレイにオブジェクトを挿入**ノードを使用して追加します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/list-2.png)

</div>

試してみてください。新しいウィザードを使って、新しい人物をリストに追加することができます！

## **コンポーネントスタック**上で最上位のコンポーネントを確認する

ウィザードではまだ「ステップxの3」というテキストがあります。それを機能させたいと思います。「新しい人物を追加するポップアップ」に戻りましょう。**コンポーネントスタック**には、現在最上位にあるコンポーネントの名前を保持する**トップコンポーネント名**という出力があります。これは**コンポーネントスタック**内のコンポーネントの名前であり、それを表すために使用されるコンポーネントではありません

。したがって、この場合は`ステップ1 - 名前`、`ステップ2 - 国`、`ステップ3 - 場所`になります。これを1、2、3の数字に変換できれば、それを**文字列フォーマット**に供給できます。さらに簡単な解決策は、**スタックの深さ**プロパティを使用することです。**プッシュ**ではなく**置き換え**を使用するため、**コンポーネントスタック**は1から2、3へとサイズが増え、それはまさに私たちが求めるものです。それを**文字列フォーマット**ノードに接続します。

<div className="ndl-image-with-background">

![](/docs/guides/navigation/component-stack/stack-depth.png)

</div>

## データが入力されていることを確認する

完成まであとわずかです。このウィザードを改善する方法はたくさんありますが、ユーザーに次のステップに進む前に何かを選択させる必要があることは明らかです。たとえば、国を選択しないと`ステップ3`がうまく機能しません。

`ステップ1`では、**テキスト入力**ノードから出力される**テキスト**の長さを見ることができます。これは**文字列**ノードで行い、**長さ**出力を使用します。これら3つの長さの値を式に接続し、すべてがゼロより大きいことを確認します（式は`a>0&&b>0&&c>0`を使用）。次に、その式の**結果**を「次へ」ボタンの**有効**入力に接続します。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/step-1-6.png)

</div>

`ステップ2`と`ステップ3`では、基本的に同じことを行いますが、**ラジオボタングループ**の**値**の長さを見ます。

完成です！ポップアップで新しい人物を追加するための小さなウィザードを作成しました！

<ReactPlayer
  playing
  autoplay
  muted
  loop
  url="/2.9/docs/guides/navigation/component-stack/component-stack-final.mp4"
/>

以下のインポートボタンをクリックして最終プロジェクトをインポートしてください。

<div className="ndl-image-with-background l">

![](/docs/guides/navigation/component-stack/final-1.png)

<ImportButton
  zip="/docs/guides/navigation/component-stack/component-stack-1.zip"
  name="ポップアップのウィザード"
  thumb="/docs/guides/navigation/component-stack/final-1.png"
/>

</div>